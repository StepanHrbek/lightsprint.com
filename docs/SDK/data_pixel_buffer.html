<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LightsprintSDK: Pixel buffer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LightsprintSDK<span id="projectnumber">&#160;2021.08.08</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('data_pixel_buffer.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Pixel buffer</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Pixel buffer (2d texture) is designed for storage of per-pixel data for single object (Light map, Ambient occlusion map, Bent normal map).</p>
<h1><a class="anchor" id="d21"></a>
Suitable for</h1>
<table class="doxtable">
<tr>
<th></th><th>global or direct or indirect illumination </th><th>ambient occlusion </th><th>bent normals  </th></tr>
<tr>
<th>static objects </th><td>YES </td><td>YES </td><td>YES  </td></tr>
<tr>
<th>dynamic objects </th><td>NO  </td><td>YES </td><td>YES  </td></tr>
<tr>
<th>realtime calculated illumination </th><td>NO  </td><td>NO  </td><td>NO   </td></tr>
<tr>
<th>precalculated illumination </th><td>YES </td><td>YES </td><td>YES  </td></tr>
</table>
<h1><a class="anchor" id="d22"></a>
Advantages</h1>
<ul>
<li>High precision and detail without additional vertices.</li>
<li>No need for good triangulation.</li>
<li>Very low resolution is sufficient (with good unwrap) for ambient maps (lightmaps with indirect illumination). Ambient maps contain mostly low frequencies, no sharp edges.</li>
<li>If you don't precompute bent normals, ambient lighting values don't depend on view angle, so rendering is very fast.</li>
<li>If you do precompute bent normals, normal maps work great even in shadows, knowing direction of incoming indirect light.</li>
</ul>
<h1><a class="anchor" id="d23"></a>
Disadvantages</h1>
<ul>
<li>One more uv channel needed, compared to vertex buffers. (Meshes need additional uv channel with unwrap, for mapping texture. If you don't have it, ask your 3d artists to bake unwrap into meshes as an additional uv channel, or build unwrap automatically with <a class="el" href="classrr_1_1_r_r_objects.html#a1995f293b3e08eaaa283765d37ecd03f" title="Rebuilds unwrap in all meshes of RRMeshArrays type.">RRObjects::buildUnwrap()</a>.)</li>
</ul>
<h1><a class="anchor" id="d25"></a>
Interface, implementations</h1>
<ul>
<li><a class="el" href="classrr_1_1_r_r_buffer.html" title="Buffer, array of elements.">RRBuffer</a></li>
</ul>
<h1><a class="anchor" id="d24"></a>
Instances</h1>
<ul>
<li>stored in: <a class="el" href="classrr_1_1_r_r_object_illumination.html#a442c7ba4cc2a834014edecfb1c49076a" title="Returns illumination buffer from given layer.">RRObjectIllumination::getLayer()</a> or your arbitrary location.</li>
<li>created by: you</li>
<li>updated by: <a class="el" href="classrr_1_1_r_r_solver.html#a123529338f03195a6233b53e5100a009" title="For all static objects, calculates and updates lightmap and/or bent normal; in per-pixel or per-verte...">RRSolver::updateLightmaps()</a> or <a class="el" href="classrr_1_1_r_r_solver.html#a4aaa9ea4b5f70eb96a3313a5bf1fd592" title="For single static object, calculates and updates lightmap and/or bent normals; in per-pixel or per-ve...">RRSolver::updateLightmap()</a>.</li>
</ul>
<h1><a class="anchor" id="d26"></a>
Rendering</h1>
<ul>
<li>Map pixel buffer to your object using your uv channel with object's unwrap, read per-pixel value from texture in pixel shader and interpret it appropriately as light level, ambient occlusion or bent normal.</li>
</ul>
<h1><a class="anchor" id="d27"></a>
Examples</h1>
<ul>
<li>Generic example: <br  />
 Creating lightmap. <div class="fragment"><div class="line">lightmap = <a class="code hl_function" href="classrr_1_1_r_r_buffer.html#a3e3d651ad26701f619da5017646793c8">rr::RRBuffer::create</a>(<a class="code hl_enumvalue" href="namespacerr.html#a930c3549f9b4b1a207844b9e7d0fb286a943c772ebb2147878bb369eb847e6595">rr::BT_2D_TEXTURE</a>,256,256,1,<a class="code hl_enumvalue" href="namespacerr.html#a6d3b8b9b246e283277a19771ad7e3413a2464ce5c96d33ac7139bcffae31e715e">rr::BF_RGBF</a>,<span class="keyword">true</span>,<span class="keyword">nullptr</span>);</div>
<div class="ttc" id="aclassrr_1_1_r_r_buffer_html_a3e3d651ad26701f619da5017646793c8"><div class="ttname"><a href="classrr_1_1_r_r_buffer.html#a3e3d651ad26701f619da5017646793c8">rr::RRBuffer::create</a></div><div class="ttdeci">static RRBuffer * create(RRBufferType type, unsigned width, unsigned height, unsigned depth, RRBufferFormat format, bool scaled, const unsigned char *data)</div><div class="ttdoc">Creates buffer in system memory. See reset() for parameter details. Returns nullptr when parameters a...</div></div>
<div class="ttc" id="anamespacerr_html_a6d3b8b9b246e283277a19771ad7e3413a2464ce5c96d33ac7139bcffae31e715e"><div class="ttname"><a href="namespacerr.html#a6d3b8b9b246e283277a19771ad7e3413a2464ce5c96d33ac7139bcffae31e715e">rr::BF_RGBF</a></div><div class="ttdeci">@ BF_RGBF</div><div class="ttdoc">Floating point RGB, 96bits per pixel. High precision, suitable for any data, but some old GPUs don't ...</div><div class="ttdef"><b>Definition</b> RRBuffer.h:94</div></div>
<div class="ttc" id="anamespacerr_html_a930c3549f9b4b1a207844b9e7d0fb286a943c772ebb2147878bb369eb847e6595"><div class="ttname"><a href="namespacerr.html#a930c3549f9b4b1a207844b9e7d0fb286a943c772ebb2147878bb369eb847e6595">rr::BT_2D_TEXTURE</a></div><div class="ttdeci">@ BT_2D_TEXTURE</div><div class="ttdoc">2d texture or video, 2d array of width*height elements. Used for object's precomputed lightmaps,...</div><div class="ttdef"><b>Definition</b> RRBuffer.h:84</div></div>
</div><!-- fragment --></li>
<li>OpenGL example: Rendering with lightmap. <div class="fragment"><div class="line"><a class="code hl_class" href="classrr_1_1_r_r_solver.html">rr::RRSolver</a>* dynamicSolver;</div>
<div class="line">GLuint program;</div>
<div class="line">...</div>
<div class="line"><span class="comment">// set program created from shaders below</span></div>
<div class="line">glUseProgram(program);</div>
<div class="line"><span class="comment">// bind lightmap to texture0</span></div>
<div class="line">glActiveTexture(GL_TEXTURE0);</div>
<div class="line">getTexture(object-&gt;illumination.getLayer(0))-&gt;<a class="code hl_function" href="classrr__gl_1_1_texture.html#af6680007aa9cc0f45538e80eb6fb53e8">bindTexture</a>();</div>
<div class="line"><span class="comment">// set sampler to use texture0</span></div>
<div class="line">glUniform1i(glGetUniformLocation(program,<span class="stringliteral">&quot;lightmap&quot;</span>),0);</div>
<div class="line"><span class="comment">// enable stream with texture coordinates</span></div>
<div class="line">glEnableClientState(GL_TEXTURE_COORD_ARRAY);</div>
<div class="line"><span class="comment">// set pointer to texture coordinates</span></div>
<div class="line">glColorPointer(2, GL_FLOAT, 0, array with uv values of unwrap);</div>
<div class="line"><span class="comment">// render primitives</span></div>
<div class="line">glDrawElements...</div>
<div class="line"><span class="comment">// cleanup</span></div>
<div class="line">glDisableClientState(GL_TEXTURE_COORD_ARRAY);</div>
<div class="ttc" id="aclassrr_1_1_r_r_solver_html"><div class="ttname"><a href="classrr_1_1_r_r_solver.html">rr::RRSolver</a></div><div class="ttdoc">Global illumination solver for interactive applications.</div><div class="ttdef"><b>Definition</b> RRSolver.h:58</div></div>
<div class="ttc" id="aclassrr__gl_1_1_texture_html_af6680007aa9cc0f45538e80eb6fb53e8"><div class="ttname"><a href="classrr__gl_1_1_texture.html#af6680007aa9cc0f45538e80eb6fb53e8">rr_gl::Texture::bindTexture</a></div><div class="ttdeci">void bindTexture() const</div><div class="ttdoc">Binds texture.</div></div>
</div><!-- fragment --> Using uv coordinates in GLSL vertex shader: <div class="fragment"><div class="line">varying vec2 lightmapCoord;</div>
<div class="line"><span class="keywordtype">void</span> vertexShader()</div>
<div class="line">{</div>
<div class="line">        ...</div>
<div class="line">        lightmapCoord = gl_TexCoord.xy;</div>
<div class="line">}</div>
</div><!-- fragment --> Sampling and using illumination value in GLSL fragment shader: <div class="fragment"><div class="line">uniform sampler2D lightmap;</div>
<div class="line">varying vec2 lightmapCoord;</div>
<div class="line"><span class="keywordtype">void</span> fragmentShader()</div>
<div class="line">{</div>
<div class="line">        vec4 light = texture2D(lightmap, lightmapCoord);</div>
<div class="line">        ...</div>
<div class="line">        gl_FragColor = ... + materialColor * light;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Direct3D 9 example: Rendering with lightmap. <div class="fragment"><div class="line">IDirect3DDevice9* device;</div>
<div class="line">IDirect3DPixelShader9* vertexShader;</div>
<div class="line">IDirect3DPixelShader9* pixelShader;</div>
<div class="line"><span class="comment">// create vertex declaration that includes lightmap uv channel as TEXCOORD0</span></div>
<div class="line">IDirect3DVertexDeclaration9* vertexDeclaration;</div>
<div class="line">device-&gt;CreateVertexDeclaration(description, &amp;vertexDeclaration);</div>
<div class="line"><a class="code hl_class" href="classrr_1_1_r_r_solver.html">rr::RRSolver</a>* dynamicSolver;</div>
<div class="line">...</div>
<div class="line"><span class="comment">// set rendering pipeline to use shaders below</span></div>
<div class="line">device-&gt;SetPixelShader(vertexShader);</div>
<div class="line">device-&gt;SetPixelShader(pixelShader);</div>
<div class="line"><span class="comment">// set sampler to use lightmap</span></div>
<div class="line"><a class="code hl_class" href="classrr_1_1_r_r_buffer.html">rr::RRBuffer</a>* lightmap = <span class="keywordtype">object</span>-&gt;illumination.getLayer(0);</div>
<div class="line">...</div>
<div class="line"><span class="comment">// set vertex declaration for your mesh data,</span></div>
<div class="line"><span class="comment">//  including uv channel with unwrap</span></div>
<div class="line">device-&gt;SetVertexDeclaration(vertexDeclaration);</div>
<div class="line"><span class="comment">// set pointer to your mesh in stream 0</span></div>
<div class="line"><span class="comment">//  (vertices, uv channel, possibly normals etc.)</span></div>
<div class="line">device-&gt;SetStreamSource(0, ...);</div>
<div class="line"><span class="comment">// render primitives</span></div>
<div class="line">device-&gt;DrawPrimitive...</div>
<div class="line"><span class="comment">// cleanup</span></div>
<div class="line">device-&gt;SetStreamSource(0, <span class="keyword">nullptr</span>, 0, 0);</div>
<div class="ttc" id="aclassrr_1_1_r_r_buffer_html"><div class="ttname"><a href="classrr_1_1_r_r_buffer.html">rr::RRBuffer</a></div><div class="ttdoc">Buffer, array of elements.</div><div class="ttdef"><b>Definition</b> RRBuffer.h:168</div></div>
</div><!-- fragment --> Using uv coordinates in HLSL vertex shader: <div class="fragment"><div class="line"><span class="keywordtype">void</span> vertexShader(in float2 iLightmapCoord: TEXCOORD0,</div>
<div class="line">        ..., out float2 oLightmapCoord: TEXCOORD0)</div>
<div class="line">{</div>
<div class="line">        ...</div>
<div class="line">        oLightmapCoord = iLightmapCoord;</div>
<div class="line">}</div>
</div><!-- fragment --> Sampling and using illumination value in HLSL pixel shader: <div class="fragment"><div class="line">sampler lightmap;</div>
<div class="line"><span class="keywordtype">void</span> pixelShader(in float2 iLightmapCoord: TEXCOORD0,</div>
<div class="line">        ..., out float4 oColor: COLOR)</div>
<div class="line">{</div>
<div class="line">        float4 light = tex2D(lightmap, iLightmapCoord);</div>
<div class="line">        ...</div>
<div class="line">        oColor = ... + materialColor * light;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Alternatively, texturing could be done in fixed pipeline, without shaders, but it is beyond scope of this documentation.</li>
<li>See Direct3D, OpenGL or your engine documentation for more details on texturing and rendering with lightmap. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="main_data_access.html">Calculation and outputs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
