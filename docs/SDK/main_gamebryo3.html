<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LightsprintSDK: LightSpeed 3.1.1</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LightsprintSDK<span id="projectnumber">&#160;2021.08.08</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('main_gamebryo3.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">LightSpeed 3.1.1</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Lightsprint SDK adds global illumination to Gamebryo LightSpeed 3.1.1.</p>
<h1><a class="anchor" id="g3_prerequisites"></a>
Prerequisites</h1>
<ul>
<li>Emergent's <code>Gamebryo LightSpeed 3.1.1</code> must be installed</li>
<li><a class="el" href="gipackage.html">Fixed Global Illumination Package</a> must be installed</li>
<li>Lightsprint SDK with LightSpeed integration. To save your time, we send you Lightsprint SDK preconfigured for your engine. If we make mistake and your integration is missing, please let us know.</li>
</ul>
<h1><a class="anchor" id="g3_f"></a>
Features</h1>
<ul>
<li>Toolbench plugins let you bake global illumination in HDR, results are immediately displayed in WorldBuilder</li>
<li>illumination can be baked to lightmaps, directional lightmaps (a.k.a. radiosity normal maps), vertex colors</li>
<li>fully automatic, quality controlled by single number, optional settings in Lightsprint Model Library (HDR or LDR environment map etc)</li>
<li>postprocessing: color tone, brightness, contrast, smoothing can be changed in a second</li>
<li>baking GI for multiple scene configurations at once</li>
<li>no size limits, can process huge scenes in 64bit code, even in 32bit Toolbench</li>
<li>Lightsprint tools and samples (baking, realtime GI) support .gsa, old Gamebryo scene format (this may be dropped in future, depends on your feedback)</li>
<li>realtime GI in Gamebryo scenes can be displayed using Lightsprint renderer</li>
<li>all data can be processed in native Gamebryo format in memory, no conversion/duplication/saving to disk</li>
<li>full integration source code included</li>
</ul>
<h1><a class="anchor" id="g3_limits"></a>
Limitations of current version</h1>
<ul>
<li>GI Package 2.1.1 has several issues, currently being adressed, with fix expected soon:<ul>
<li>Results of baking may fail to appear or save to disk. One of these may help to workaround the issue: 1) Click Toggle Precomputed Lights icon. 2) Click Toggle Default Lights icon. 3) Unset and set LightingFile in GIScene. 4) Reopen block. 5) Bake again.</li>
<li>Plugin request to display GI after bake is ignored. Click "Toggle Precomputed Lights" icon manually.</li>
</ul>
</li>
<li>Terrain lightmaps not supported. This is long term GI Package limitation.</li>
<li>Light probes not updated. We will support them in next GI Package.</li>
</ul>
<h1><a class="anchor" id="g3_bake"></a>
Baking in Toolbench</h1>
<ul>
<li>Run <code>bin/install_toolbench_plugins.bat</code>.</li>
<li>Run Toolbench (default configuration VC90/Shipping).</li>
</ul>
<h2><a class="anchor" id="g3_sample"></a>
- preconfigured examples</h2>
<ul>
<li>Open sample scene in Lightsprint SDK <code>data\Lightspeed\GameFrameworkSample.gsl</code></li>
<li>Open WorldBuilder by doubleclicking .block file in game solution, pick Cathedral for bigger or CornellBox for smaller scene.</li>
<li>GI is already present. You can rebuild it by clicking menu Lightsprint / Bake lighting. <br  />
 Small window shows baking progress and lets you abort operation. <br  />
 Baking at default medium quality takes around 10s for CornellBox, 2min for Cathedral. <br  />
 Computed GI appears in WorldBuilder and it is also saved to disk immediately. <table border="0">
<tr>
<td><div class="image">
<img src="Toolbench-Cornell.jpg" alt=""/>
</div>
 </td><td><div class="image">
<img src="Toolbench-Cathedral.jpg" alt=""/>
</div>
 </td></tr>
</table>
</li>
<li>Click any LightsprintScene or LightsprintMesh entity to access bake settings, see below. If you change settings, bake again to see lightmaps change.</li>
</ul>
<h2><a class="anchor" id="g3_library"></a>
- using Lightsprint Model Library</h2>
<ul>
<li>Using LightsprintScene and LightsprintMesh models instead of GIScene and PCLMesh will give you access to important bake settings. <table border="0">
<tr>
<td><div class="image">
<img src="Toolbench-LightsprintScene.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Toolbench-LightsprintMesh.png" alt=""/>
</div>
 </td></tr>
</table>
</li>
<li>LightsprintModelLibrary and GIModelLibrary must be copied to and then referenced from your solution. It is already done in our samples. Game Solution Wizard offers to do it automatically for new projects. For old projects, manually copy <code>$(EMERGENT_PATH)\Media\GIModelLibrary</code> and <code>EMERGENT_PATH%\sdk\Win32\Bin\VC90\Shipping\Plugins\Lightsprint.Toolbench.Plugin\LightsprintModelLibrary</code> directories next to <code>StandardModelLibrary</code> in your asset web, then open your solution in Toolbench, doubleclick .block file in Game Solution panel, expand it, right click References under .block file, select Add Reference, enter <code>LightsprintModelLibrary</code> directory and select <code>LightsprintModelLibrary.emtproj</code>. Add reference to GIModelLibrary in the same way.</li>
</ul>
<h2><a class="anchor" id="g3_other_solutions"></a>
- configuring your scenes</h2>
<ul>
<li>If your scene alredy contains GIScene entity, transmogrify it to LightsprintScene, otherwise create new LightsprintScene.</li>
<li>If some of your meshes need non-default settings, transmogrify them to LightsprintMesh-es.</li>
<li>Adjust settings in LightsprintScene and LightsprintMesh entities. Note that default quality is low, per-vertex.</li>
<li>Run Lightsprint / Bake lighting as usual.</li>
</ul>
<h2><a class="anchor" id="g3_mix"></a>
- mixing realtime and precomputed illumination</h2>
<ul>
<li>LightSpeed supports rendering realtime direct and precomputed indirect illumination.</li>
<li>To bake indirect illumination only, set light properties UseForPrecomputedLighting, LightPCLObjectsAtRuntime and LightNonPCLObjectsAtRuntime to true.</li>
</ul>
<h2><a class="anchor" id="g3_exclude"></a>
- excluding lights and meshes from GI solution</h2>
<ul>
<li>To exclude PCL mesh or light, set UseForPrecomputedLighting=false.</li>
<li>To exclude non-PCL mesh, set IsCastingShadow=false.</li>
<li>To exclude all non-PCL meshes, set LsUseNonPCLMeshes=false in LightsprintScene.</li>
<li>To exclude all non-PCL lights, set LsUseNonPCLLights=false in LightsprintScene.</li>
</ul>
<h2><a class="anchor" id="g3_resolution"></a>
- lightmap resolution</h2>
<ul>
<li>LightsprintScene and LightsprintMesh properties let you control lightmap resolution globally and then tweak it for individual meshes.</li>
<li>For fixed resolution, change mesh property LsResolutionMode to "Use Fixed Resolution".</li>
<li>If LsResolutionMode stays at default "Calculate from LsPixelsPerWorldUnit*LsResolutionMultiplier", resolution is calculated in 4 steps:<ul>
<li>When building lightmap for mesh, we look at mesh surface and calculate lightmap resolution so that there is LsPixelsPerWorldUnit lightmap pixels in 1 length unit of surface. Lightmap may be stretched differently in different parts of mesh, so we average this measurement over all edges of the mesh.</li>
<li>Then, resolution is multiplied by LsResolutionMultiplier.</li>
<li>Then, resolution is rounded up to power of two. If you have use for non power of two resolutions, we will add checkbox to disable rounding.</li>
<li>Finally, resolution is limited to be &gt;=32 and &lt;=2048. Let us know if you want to change these limits, we will expose them in LightsprintScene.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="g3_cache"></a>
- lightmap cache</h2>
<ul>
<li>located in (temp)/LightmapCache/(block_name)</li>
<li>how does it work?<ul>
<li>"Bake lighting"/"Bake selected" calculates lighting, saves raw .exr lightmaps to cache (overwriting previous cache contents) and saves postprocessed lightmaps to Gamebryo's .nif</li>
<li>"Bake from cache"/"Bake selected from cache" reads raw lightmaps from cache and saves postprocessed lightmaps to Gamebryo's .nif</li>
</ul>
</li>
<li>serves three purposes<ul>
<li>Makes postprocessing near instant. Once cache is filled by "Bake lighting", you can change color tone, brightness, contrast, smoothing and compression and apply changes by "Bake lighting from cache".</li>
<li>Lets you look at lightmaps. Once cache is filled by "Bake lighting", you can look at lightmaps in any modern image viewer. (Note that there are no tools for looking at lightmaps in Gamebryo's .nif).</li>
<li>Lets you edit lightmaps. Once cache is filled by "Bake lighting", you can edit cached lightmaps and apply results to scene by "Bake lighting from cache".</li>
</ul>
</li>
<li>can be disabled by deleting <code>#define LIGHTMAP_CACHE</code> from <code>Lightsprint.Toolbench.Plugin.cpp</code> and rebuilding plugin</li>
</ul>
<h2><a class="anchor" id="g3_selection"></a>
- baking selected entities</h2>
<ul>
<li>commented out in src/Lightsprint.Toolbench.Plugin.UI/plugin.xml due to bug in GI Package 2.1.1</li>
<li>ready for GI Package Next</li>
<li>"Bake selected" and "Bake selected from cache" update lighting only for entities selected in World Builder</li>
</ul>
<h2><a class="anchor" id="g3_configs"></a>
- baking multiple configurations at once</h2>
<ul>
<li>LightsprintMesh properties LsReplacementCase and LsReplacementConfiguration let you define multiple scene configurations</li>
<li>GI is automatically baked for all configurations at once, without increasing baking time</li>
</ul>
<h2><a class="anchor" id="g3_opti"></a>
- reducing bake time</h2>
<ul>
<li>Baking time depends nearly linearly on quality and number of texels and vertex colors calculated.</li>
<li>Reduce number of texels calculated. Make all lightmaps smaller by reducing LsPixelsPerWorldUnit. Bake and if lighting errors (leaks) show up or lighting is too blurry, increase lightmap sizes in objects that need it.</li>
<li>Select hi-poly meshes and change LsBakeTarget to Vertices. Bake and if lighting is too blurry, change target back in objects that need it.</li>
<li>Decrease quality and compensate it by increasing smoothing.</li>
<li>Use lower quality/resolution for non final builds.</li>
<li>Use faster CPU. Performance increases nearly linearly with number of cores.</li>
</ul>
<h1><a class="anchor" id="g3_max"></a>
Preparing art assets</h1>
<ul>
<li>Lightsprint SDK integration includes sample scenes (Cathedral, CornellBox) that work out of the box. When preparing new scene for baking, one must follow Gamebryo rules:</li>
<li>Due to GI Package 2.1.1 bug, LightMapMaterial is not available in 3ds Max out of the box. To fix it, open GI Package solution in VS 2005 (usually <code>C:\Emergent\Integrations\LightSpeed_GlobalIllumination_2.1.1\Build\Win32\VC80\Gamebryo_GI.sln</code>), change configuration to Shipping DLL and rebuild.</li>
<li>See GI Package documentation, usually installed at <code>C:\Emergent\Integrations\LightSpeed_GlobalIllumination_2.1.1\Documentation\GI Package Documentation.pdf</code></li>
<li>See video tutorial at <a href="https://pulse.emergent.net/index.php?autocom=downloads&showfile=288">https://pulse.emergent.net/index.php?autocom=downloads&amp;showfile=288</a>, it shows how to set up your objects to receive light maps in your art tool. While other parts of the tutorial are Gamebryo 2.6 specific, this part is still relevant for Gamebyo 3.1.1.</li>
<li>Note that you need meshes with unwrap uv channel only for baking GI into lightmap textures. If you don't have unwrap, you can still set LsBakeTarget=Vertices and bake GI into vertices.</li>
</ul>
<h1><a class="anchor" id="g3_gsa"></a>
Legacy .gsa support</h1>
<ul>
<li>our tools from <a class="el" href="main_gamebryo26.html">Gamebryo 2.6 integration</a> still work under LightSpeed</li>
<li>this includes both offline and realtime GI</li>
<li>note that our legacy samples read scenes from Gamebryo 2.6 and GI Package 1.0.0 directories, those must be installed for samples to work <table border="0">
<tr>
<td><div class="image">
<img src="BuildLightmaps_2.jpg" alt=""/>
</div>
 </td><td><div class="image">
<img src="Gamebryo-RT2.jpg" alt=""/>
</div>
 </td></tr>
</table>
</li>
</ul>
<h1><a class="anchor" id="g3_backporting"></a>
Legacy Lightspeed support</h1>
<ul>
<li>SDK includes source code of Toolbench plugins, you can build it with any Lightspeed 3.x and GI Package 2.x version installed (possibly with minor modifications, we stopped testing old versions).</li>
<li>Before building plugins in legacy environment, make sure that legacy DirectX SDK is used (Gamebryo 2.6 requires DirectX SDK aug08, 3.0 requires nov08, 3.1. requires mar09, 3.1.1 requires aug09), you may need to modify paths in Lightsprint.Toolbench.Plugin.vcproj.</li>
</ul>
<h1><a class="anchor" id="g3_source"></a>
Source code</h1>
<ul>
<li>if you are full source code licensee, open <code>src/Lightsprint.vs2010.sln</code> and build 64bit Release DLL BuildLightmaps</li>
<li>open <code>src/Lightsprint.vs2008.sln</code></li>
<li>see <code>Lightsprint.Toolbench.Plugin</code> and <code>Lightsprint.Toolbench.Plugin.UI</code> projects, feel free to customize them or tell us what needs to be changed to match your needs</li>
<li>for standard VC90/Shipping Toolbench, build plugins in Shipping DLL Win32 configuration</li>
<li>if you build Debug DLL or Release DLL Win32 plugins, use them by running VC90 Debug / Release Toolbench</li>
<li>Gamebryo does not support 64bit plugins, so x64 configurations have plugin build disabled</li>
<li>compilation of plugins invokes <code>bin/install_toolbench_plugins.bat</code> that installs plugins together with 32bit and 64bit BuildLightmaps tool (plugin calls 64bit BuildLightmaps in 64bit Windows, 32bit in 32bit)</li>
<li>let us know if you need projects for different compiler version</li>
</ul>
<h1><a class="anchor" id="g3_depl"></a>
Deployment</h1>
<ul>
<li><code>bin/install_toolbench_plugins.bat</code> installs plugins and model library to Toolbench. It simply copies files from Lightsprint SDK.</li>
<li>If you modify and rebuild plugins, they are installed automatically.</li>
<li>Everything plugins need is in their Toolbench directories, Lightsprint SDK is not needed, so deployment to other computers is simple directory copy. Plugin directories are (in case of standard VC90 Shipping configuration) <code>$(EMERGENT_PATH)\sdk\Win32\Bin\VC90\Shipping\Plugins\Lightsprint.Toolbench.Plugin</code> and <code>$(EMERGENT_PATH)\sdk\Win32\Bin\VC90\Shipping\Plugins\Lightsprint.Toolbench.Plugin.UI</code>.</li>
</ul>
<h1><a class="anchor" id="g3_trouble"></a>
Troubleshooting</h1>
<ul>
<li><a class="el" href="trouble_memory.html">How to process even bigger scenes</a></li>
<li><a class="el" href="trouble_gamebryo_error_shader.html">Wrong color bleeding in Gamebryo</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
