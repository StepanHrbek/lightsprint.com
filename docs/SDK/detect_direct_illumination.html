<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LightsprintSDK: Detect direct illumination</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LightsprintSDK<span id="projectnumber">&#160;2021.08.08</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('detect_direct_illumination.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Detect direct illumination</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>For OpenGL based renderers, LightsprintGL implements detection of direct illumination in <a class="el" href="classrr__gl_1_1_r_r_solver_g_l.html" title="Implementation of rr::RRSolver generic GPU operations using OpenGL 2.0.">rr_gl::RRSolverGL</a>.</p>
<p>For Direct3D and custom renderers, you need to write your own implementation.</p>
<h1><a class="anchor" id="ddi_what_to_detect"></a>
What needs to be detected</h1>
<p>Imagine that you render static scene with only direct lighting/shadowing and all materials diffuse white. </p><div class="image">
<img src="ddi2.jpg" alt=""/>
</div>
<p>We need to know average color of each triangle under such conditions. </p><div class="image">
<img src="ddi1.jpg" alt=""/>
</div>
<p>We expect it in array of RGBA8 values, with length = number of triangles in static scene.</p>
<h1><a class="anchor" id="ddi_what_to_do"></a>
What to do with detected values</h1>
<p>Call <a class="el" href="classrr_1_1_r_r_solver.html#a3769d618693b82f168fe3cb8f91b78c8" title="Sets custom irradiance for all static triangles in scene.">RRSolver::setDirectIllumination()</a>.</p>
<h1><a class="anchor" id="ddi_why"></a>
Why is it important</h1>
<p>We have no other knowledge about your lights. You can use many light types with very complex lighting equations. You can arbitrarily change them. No problem. Just let us know what are the results - average colors produced by your shader.</p>
<h1><a class="anchor" id="ddi_impl"></a>
How to implement it</h1>
<p>Render whole static scene with white diffuse material, with direct lighting only.</p>
<p>Modify your shader so that instead of rendering triangles in 3d space, they are arranged in 2d matrix.</p>
<div class="image">
<img src="detect-nodif.png" alt=""/>
</div>
<p>Scale down to get average triangle color.</p>
<div class="image">
<img src="detect-scaled.png" alt=""/>
</div>
<p>Read texture back and you have an array of colors that can be sent to <a class="el" href="classrr_1_1_r_r_solver.html#a3769d618693b82f168fe3cb8f91b78c8" title="Sets custom irradiance for all static triangles in scene.">RRSolver::setDirectIllumination()</a>.</p>
<h1><a class="anchor" id="ddi_impl_details"></a>
Possible implementation details</h1>
<p>Rendering faces into 2d matrix requires one renderer enhancement - 2d position override - ability to render triangles to specified 2d positions while preserving their original look.</p>
<p>For DX10 generation GPUs, solution is nearly as simple as adding two lines into geometry shader. Render as usual, using any combination of trilist/strip/indexed/nonindexed data, but at the end of geometry shader, override output vertex positions passed to rasterizer by new 2d triangle positions calculated right there from primitive id.</p>
<p>For DX9 generation GPUs, implemention has two steps:</p><ul>
<li>Triangle positions in matrix are generated by CPU into new vertex stream. At the end of vertex shader, vertex position passed to fragment shader is replaced by position read from additional vertex stream.</li>
<li>For purpose of detection, scene is rendered using non-indexed triangle list. This is necessary because if we want to render triangles with shared vertices to completely different positions in texture, we have to split that vertices.</li>
</ul>
<h1><a class="anchor" id="ddi_debug"></a>
Debugging</h1>
<p>If you call rr_ed::sceneViewer(solver,...) after solver-&gt;setDirectIllumination() and then select menu item Help/Render DDI, scene viewer visualizes data sent to setDirectIllumination(). </p><div class="image">
<img src="ddi1.jpg" alt=""/>
</div>
<p> With "Global illumination/Indirect illumination" property at default "Fireball", it shows reference data produced by our implementation. After switching "Indirect illumination" to "none", it shows your data. Both results should be quite close, with only small noise-like differences. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="main_techniques.html">Techniques</a></li><li class="navelem"><a class="el" href="integration_realtime_3.html">Realtime GI in any renderer</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
